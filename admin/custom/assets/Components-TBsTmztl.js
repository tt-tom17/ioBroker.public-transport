import{j as e}from"./DefaultPropsProvider-CLe-DXgN.js";import{A as I,a as v}from"./AdminComponentEasyAccessSet__mf_v__runtimeInit__mf_v__-9o5tLcPN.js";import{A as t}from"./AdminComponentEasyAccessSet__loadShare___mf_0_mui_mf_1_material__loadShare__-EKOPJIKX.js";import{A as n}from"./AdminComponentEasyAccessSet__loadShare___mf_0_iobroker_mf_1_adapter_mf_2_react_mf_2_v5__loadShare__-CmYJ37BE.js";import{D as T,T as w,a as _,S as D,b as A,c as k}from"./Tram-DfEnfuV-.js";import{A as S}from"./AdminComponentEasyAccessSet__loadShare___mf_0_mui_mf_1_icons_mf_2_material__loadShare__-CljkirG-.js";import"./createTheme-7CZNbMr1.js";import"./AdminComponentEasyAccessSet__loadShare__react__loadShare__-CJmceRyn.js";import"./_commonjsHelpers-CE1G-McA.js";import"./createSvgIcon-BA2rfUM-.js";import"./defaultTheme-BJjGWN-J.js";const{loadShare:B}=v,{initPromise:W}=I,N=W.then(o=>B("@iobroker/json-config",{customShareInfo:{shareConfig:{singleton:!0,strictVersion:!1,requiredVersion:"*"}}})),P=await N.then(o=>o());var x=P;const y={suburban:!0,subway:!0,tram:!0,bus:!0,ferry:!0,express:!0,regional:!0},F=[{key:"express",label:"ice_ic_ec",icon:T,color:"#EC0016"},{key:"regional",label:"re_rb",icon:w,color:"#1455C0"},{key:"suburban",label:"s_bahn",icon:_,color:"#008D4F"},{key:"subway",label:"u_bahn",icon:D,color:"#0065AE"},{key:"tram",label:"tram",icon:_,color:"#D5001C"},{key:"bus",label:"bus",icon:A,color:"#A5027D"},{key:"ferry",label:"ferry",icon:k,color:"#0080C8"}],G=({products:o,onChange:s,disabled:a=!1})=>{const r=(l,i)=>{s({...o,[l]:i})};return e.jsxs(t.Paper,{variant:"outlined",sx:{p:2},children:[e.jsx(t.Typography,{variant:"subtitle2",sx:{mb:1},children:n.I18n.t("transport_types")}),e.jsx(t.Box,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:F.map(({key:l,label:i,icon:c,color:h})=>e.jsx(t.FormControlLabel,{disabled:a,control:e.jsx(t.Checkbox,{checked:o[l]??!0,onChange:d=>r(l,d.target.checked),sx:{color:h,"&.Mui-checked":{color:h}},size:"small"}),label:e.jsxs(t.Box,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(c,{sx:{color:a?"grey.500":h,fontSize:20}}),e.jsx(t.Typography,{variant:"body2",color:a?"text.disabled":"text.primary",children:n.I18n.t(i)})]})},l))})]})},V=({station:o,onUpdate:s})=>{const a=c=>{o&&s&&s(o.id,{customName:c.target.value})},r=c=>{o&&s&&s(o.id,{enabled:c.target.checked})},l=c=>{if(o&&s){const h=parseInt(c.target.value,10);!isNaN(h)&&h>0&&s(o.id,{numDepartures:h})}},i=c=>{o&&s&&s(o.id,{products:c})};return e.jsxs(t.Paper,{sx:{p:2,height:"100%"},children:[e.jsx(t.Typography,{variant:"h6",sx:{mb:2},children:n.I18n.t("station_configuration")}),o?e.jsxs(t.Box,{children:[e.jsxs(t.Typography,{variant:"body2",color:"text.secondary",sx:{mb:3},children:[n.I18n.t("configuration_for_station"),": ",o.name]}),e.jsxs(t.Box,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(t.TextField,{label:n.I18n.t("station_id"),value:o.id,disabled:!0,fullWidth:!0,size:"small"}),e.jsx(t.TextField,{label:n.I18n.t("station_name"),value:o.name,disabled:!0,fullWidth:!0,size:"small"}),e.jsx(t.TextField,{label:n.I18n.t("custom_name"),value:o.customName||o.name,onChange:a,fullWidth:!0,size:"small",helperText:n.I18n.t("custom_name_hint")}),e.jsx(t.FormControlLabel,{control:e.jsx(t.Switch,{checked:o.enabled!==!1,onChange:r}),label:n.I18n.t("enabled")}),e.jsx(t.TextField,{label:n.I18n.t("departure_count"),type:"number",value:o.numDepartures||3,onChange:l,fullWidth:!0,size:"small",inputProps:{min:1,max:50},helperText:n.I18n.t("departure_count_hint")}),e.jsx(t.Divider,{sx:{my:1}}),e.jsx(G,{products:o.products||y,onChange:i,disabled:o.enabled===!1})]})]}):e.jsx(t.Box,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"80%",color:"text.secondary"},children:e.jsx(t.Typography,{variant:"body2",children:n.I18n.t("select_station_to_configure")})})]})},L=({stations:o,selectedStationId:s,onAddStation:a,onDeleteStation:r,onStationClick:l})=>e.jsxs(t.Paper,{sx:{p:2,height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(t.Box,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(t.Typography,{variant:"h6",children:n.I18n.t("stations_overview")}),e.jsx(t.Button,{variant:"contained",startIcon:e.jsx(S.Add,{}),onClick:a,size:"small",children:n.I18n.t("add_station")})]}),e.jsx(t.Box,{sx:{flexGrow:1,overflow:"auto"},children:o.length===0?e.jsx(t.Box,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",color:"text.secondary"},children:e.jsx(t.Typography,{variant:"body2",children:n.I18n.t("no_stations_hint")})}):e.jsx(t.List,{children:o.map(i=>e.jsxs(t.ListItemButton,{selected:s===i.id,sx:{border:"1px solid",borderColor:"divider",borderRadius:1,mb:1,opacity:i.enabled===!1?.5:1,"&.Mui-selected":{backgroundColor:"action.selected"}},onClick:()=>l(i.id),children:[e.jsx(t.ListItemText,{primary:i.customName||i.name,secondary:e.jsxs(e.Fragment,{children:[e.jsxs(t.Typography,{component:"span",variant:"caption",display:"block",children:["ID: ",i.id]}),i.customName&&i.customName!==i.name&&e.jsxs(t.Typography,{component:"span",variant:"caption",display:"block",color:"text.secondary",children:["Original: ",i.name]}),e.jsx(t.Typography,{component:"span",variant:"caption",display:"block",children:i.enabled===!1?n.I18n.t("disabled"):n.I18n.t("active")})]}),primaryTypographyProps:{fontWeight:500},secondaryTypographyProps:{component:"div"}}),e.jsx(t.IconButton,{edge:"end","aria-label":"delete",onClick:c=>{c.stopPropagation(),r(i.id)},size:"small",children:e.jsx(S.Delete,{})})]},i.id))})})]});class g extends x.ConfigGeneric{searchTimeout=null;constructor(s){super(s),this.state={...this.state,searchQuery:"",stations:[],selectedStation:null,loading:!1,error:null}}handleClose=()=>{this.props.onClose&&this.props.onClose(),this.setState({searchQuery:"",stations:[],selectedStation:null,error:null})};handleSearchChange=s=>{const a=s.target.value;this.setState({searchQuery:a}),this.searchTimeout&&clearTimeout(this.searchTimeout),a.length>=2?this.searchTimeout=setTimeout(()=>{this.searchStations(a)},500):this.setState({stations:[],selectedStation:null})};searchStations=async s=>{this.setState({loading:!0,error:null});try{const a=await this.props.oContext.socket.sendTo(`${this.props.oContext.adapterName}.${this.props.oContext.instance}`,"location",{query:s});a&&Array.isArray(a)?this.setState({stations:a,loading:!1}):this.setState({stations:[],loading:!1,error:n.I18n.t("stationSearch_no_results_found")})}catch(a){this.setState({loading:!1,error:n.I18n.t("stationSearch_error").replace("%s",a instanceof Error?a.message:String(a))})}};handleStationSelect=s=>{this.setState({selectedStation:s})};handleConfirm=()=>{this.state.selectedStation&&(console.log("Confirming station:",this.state.selectedStation),this.props.onStationSelected&&this.props.onStationSelected(this.state.selectedStation.id,this.state.selectedStation.name),this.handleClose())};renderItem(s,a){const{searchQuery:r,stations:l,selectedStation:i,loading:c,error:h}=this.state;return e.jsxs(t.Dialog,{open:!0,onClose:this.handleClose,maxWidth:"sm",fullWidth:!0,children:[e.jsx(t.DialogTitle,{children:n.I18n.t("stationSearch_title")}),e.jsxs(t.DialogContent,{children:[e.jsx(t.TextField,{autoFocus:!0,fullWidth:!0,label:n.I18n.t("stationSearch_input_label"),value:r,onChange:this.handleSearchChange,placeholder:n.I18n.t("stationSearch_input_placeholder"),sx:{mt:2,mb:2}}),c&&e.jsx(t.Box,{sx:{display:"flex",justifyContent:"center",p:2},children:e.jsx(t.CircularProgress,{})}),h&&e.jsx(t.Typography,{color:"error",sx:{p:2,textAlign:"center"},children:h}),!c&&!h&&l.length>0&&e.jsx(t.List,{sx:{maxHeight:400,overflow:"auto"},children:l.map(d=>{var m,f;return e.jsx(t.ListItem,{disablePadding:!0,children:e.jsx(t.ListItemButton,{selected:(i==null?void 0:i.id)===d.id,onClick:()=>this.handleStationSelect(d),children:e.jsx(t.ListItemText,{primary:d.name,secondary:d.type?`${d.type}${d.location?` (${(m=d.location.latitude)==null?void 0:m.toFixed(4)}, ${(f=d.location.longitude)==null?void 0:f.toFixed(4)})`:""}`:d.id})})},d.id)})}),!c&&!h&&r.length>=2&&l.length===0&&e.jsx(t.Typography,{color:"text.secondary",sx:{p:2,textAlign:"center"},children:n.I18n.t("stationSearch_no_results")}),r.length<2&&e.jsx(t.Typography,{color:"text.secondary",sx:{p:2,textAlign:"center"},children:n.I18n.t("stationSearch_min_chars")})]}),e.jsxs(t.DialogActions,{children:[e.jsx(t.Button,{onClick:this.handleClose,children:n.I18n.t("stationSearch_cancel")}),e.jsx(t.Button,{onClick:this.handleConfirm,variant:"contained",disabled:!i,children:n.I18n.t("stationSearch_confirm")})]})]})}}class E extends x.ConfigGeneric{constructor(s){super(s);const a=x.ConfigGeneric.getValue(this.props.data,"departures"),r=Array.isArray(a)?a:[];this.state={...this.state,stations:r,selectedStationId:null,showSearchDialog:!1}}componentDidMount(){const s=x.ConfigGeneric.getValue(this.props.data,"departures");Array.isArray(s)&&this.setState({stations:s})}componentDidUpdate(s){if(s.data!==this.props.data){const a=x.ConfigGeneric.getValue(this.props.data,"departures");Array.isArray(a)&&this.setState({stations:a})}}handleAddStation=()=>{this.setState({showSearchDialog:!0})};handleStationSelected=async(s,a)=>{const r={id:s,name:a,customName:a,enabled:!0,numDepartures:10,products:{...y}};if(!this.state.stations.some(i=>i.id===s)){const i=[...this.state.stations,r];this.setState({stations:i,selectedStationId:s}),await this.onChange("departures",i)}this.setState({showSearchDialog:!1})};handleDeleteStation=async s=>{const a=this.state.stations.filter(r=>r.id!==s);this.setState({stations:a}),await this.onChange("departures",a),this.state.selectedStationId===s&&this.setState({selectedStationId:null})};handleStationUpdate=async(s,a)=>{const r=this.state.stations.map(l=>l.id===s?{...l,...a}:l);this.setState({stations:r}),await this.onChange("departures",r)};handleStationClick=s=>{this.setState({selectedStationId:s})};handleCloseSearch=()=>{this.setState({showSearchDialog:!1})};render(){const{stations:s,selectedStationId:a,showSearchDialog:r}=this.state,l=s.find(i=>i.id===a)||null;return e.jsxs(t.Box,{sx:{height:"100%",p:{xs:1,sm:2}},children:[e.jsxs(t.Grid,{container:!0,spacing:{xs:1,sm:2},sx:{height:"100%",flexDirection:{xs:"column",md:"row"}},children:[e.jsx(t.Grid,{item:!0,xs:12,md:5,sx:{height:{xs:"auto",md:"100%"},minHeight:{xs:300,md:"auto"},maxHeight:{xs:400,md:"none"}},children:e.jsx(L,{stations:s,selectedStationId:a,onAddStation:this.handleAddStation,onDeleteStation:this.handleDeleteStation,onStationClick:this.handleStationClick})}),e.jsx(t.Grid,{item:!0,xs:12,md:7,sx:{height:{xs:"auto",md:"100%"},minHeight:{xs:200,md:"auto"}},children:e.jsx(V,{station:l,onUpdate:this.handleStationUpdate})})]}),e.jsx(t.Dialog,{open:r,onClose:this.handleCloseSearch,maxWidth:"md",fullWidth:!0,fullScreen:!1,sx:{"& .MuiDialog-paper":{m:{xs:1,sm:2},maxHeight:{xs:"calc(100% - 16px)",sm:"calc(100% - 64px)"},width:{xs:"calc(100% - 16px)",sm:"auto"}}},children:e.jsx(g,{...this.props,onStationSelected:this.handleStationSelected,onClose:this.handleCloseSearch})})]})}}class z extends x.ConfigGeneric{constructor(s){super(s),this.state={...this.state,showStationSearch:!1}}renderItem(s,a){const r=x.ConfigGeneric.getValue(this.props.data,"hafasProfile"),l=x.ConfigGeneric.getValue(this.props.data,"clientName"),i=x.ConfigGeneric.getValue(this.props.data,"stationId"),c=x.ConfigGeneric.getValue(this.props.data,"stationName"),h=async u=>{const p=u.target.value;await this.onChange("hafasProfile",p)},d=async u=>{const p=u.target.value;await this.onChange("clientName",p)},m=()=>{this.setState({showStationSearch:!0})},f=()=>{this.setState({showStationSearch:!1})},C=async(u,p)=>{console.log("Station selected:",{id:u,name:p}),console.log("Saving stationId:",u),console.log("Saving stationName:",p),await this.onChange("stationId",u),await this.onChange("stationName",p);const j=x.ConfigGeneric.getValue(this.props.data,"stationId"),b=x.ConfigGeneric.getValue(this.props.data,"stationName");console.log("Saved values:",{savedId:j,savedName:b}),this.setState({showStationSearch:!1})};return e.jsxs(t.Box,{sx:{p:{xs:1,sm:2},maxWidth:1200,mx:"auto"},children:[e.jsx(t.Typography,{variant:"h5",sx:{mb:{xs:2,sm:3},fontSize:{xs:"1.25rem",sm:"1.5rem"}},children:n.I18n.t("hafasConfig_title")}),e.jsxs(t.Box,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,mb:3},children:[e.jsxs(t.FormControl,{sx:{flex:{sm:"1 1 0"},minWidth:{xs:"100%",sm:200}},disabled:a,fullWidth:!0,children:[e.jsx(t.InputLabel,{id:"hafas-profile-label",children:n.I18n.t("hafasConfig_profile_label")}),e.jsxs(t.Select,{labelId:"hafas-profile-label",id:"hafas-profile-select",value:r||"",label:n.I18n.t("hafasConfig_profile_label"),onChange:h,children:[e.jsx(t.MenuItem,{value:"vbb",children:n.I18n.t("hafasConfig_profile_vbb")}),e.jsx(t.MenuItem,{value:"db",children:n.I18n.t("hafasConfig_profile_db")})]}),e.jsx(t.FormHelperText,{children:n.I18n.t("hafasConfig_profile_helper")})]}),e.jsx(t.FormControl,{sx:{flex:{sm:"1 1 0"},minWidth:{xs:"100%",sm:200}},disabled:a,fullWidth:!0,children:e.jsx(t.TextField,{id:"client-name-input",label:n.I18n.t("hafasConfig_clientName_label"),value:l||"",onChange:d,helperText:n.I18n.t("hafasConfig_clientName_helper"),disabled:a,fullWidth:!0})})]}),e.jsxs(t.Box,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,alignItems:{sm:"flex-start"}},children:[e.jsx(t.TextField,{label:n.I18n.t("hafasConfig_station_label"),value:c||i||"",InputProps:{readOnly:!0},helperText:i?n.I18n.t("hafasConfig_station_helper_id").replace("%s",i):n.I18n.t("hafasConfig_station_helper_empty"),disabled:a,fullWidth:!0,sx:{flex:{sm:1}}}),e.jsx(t.Button,{variant:"contained",onClick:m,disabled:a,sx:{mt:{xs:0,sm:.5},minWidth:{xs:"100%",sm:120},height:{xs:48,sm:56}},fullWidth:!1,children:n.I18n.t("hafasConfig_station_search_button")})]}),this.state.showStationSearch&&e.jsx(g,{...this.props,onStationSelected:C,onClose:f})]})}}const Z={DepartureManager:E,HafasConfig:z,StationSearch:g};export{Z as default};
