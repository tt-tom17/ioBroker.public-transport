import{j as t}from"./jsx-runtime-DzdUgrn4.js";import{A as j,a as I}from"./AdminComponentEasyAccessSet__mf_v__runtimeInit__mf_v__-9o5tLcPN.js";import{A as e}from"./AdminComponentEasyAccessSet__loadShare___mf_0_mui_mf_1_material__loadShare__-EKOPJIKX.js";import{A as n}from"./AdminComponentEasyAccessSet__loadShare___mf_0_iobroker_mf_1_adapter_mf_2_react_mf_2_v5__loadShare__-CmYJ37BE.js";import{A as S}from"./AdminComponentEasyAccessSet__loadShare___mf_0_mui_mf_1_icons_mf_2_material__loadShare__-CljkirG-.js";import"./AdminComponentEasyAccessSet__loadShare__react__loadShare__-CJmceRyn.js";import"./_commonjsHelpers-CE1G-McA.js";const{loadShare:b}=I,{initPromise:v}=j,w=v.then(l=>b("@iobroker/json-config",{customShareInfo:{shareConfig:{singleton:!0,strictVersion:!1,requiredVersion:"*"}}})),T=await w.then(l=>l());var c=T;const A=({station:l})=>t.jsxs(e.Paper,{sx:{p:2,height:"100%"},children:[t.jsx(e.Typography,{variant:"h6",sx:{mb:2},children:n.I18n.t("Station Configuration")}),l?t.jsxs(e.Box,{children:[t.jsxs(e.Typography,{variant:"body2",color:"text.secondary",children:[n.I18n.t("Configuration for station"),": ",l.name]}),t.jsx(e.Box,{sx:{mt:2,p:2,bgcolor:"action.hover",borderRadius:1},children:t.jsx(e.Typography,{variant:"caption",color:"text.secondary",children:n.I18n.t("Configuration component will be implemented here")})})]}):t.jsx(e.Box,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"80%",color:"text.secondary"},children:t.jsx(e.Typography,{variant:"body2",children:n.I18n.t("Select a station from the list to configure it")})})]}),D=({stations:l,selectedStationId:s,onAddStation:a,onDeleteStation:o,onStationClick:h})=>t.jsxs(e.Paper,{sx:{p:2,height:"100%",display:"flex",flexDirection:"column"},children:[t.jsxs(e.Box,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[t.jsx(e.Typography,{variant:"h6",children:n.I18n.t("Stations Overview")}),t.jsx(e.Button,{variant:"contained",startIcon:t.jsx(S.Add,{}),onClick:a,size:"small",children:n.I18n.t("Add Station")})]}),t.jsx(e.Box,{sx:{flexGrow:1,overflow:"auto"},children:l.length===0?t.jsx(e.Box,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",color:"text.secondary"},children:t.jsx(e.Typography,{variant:"body2",children:n.I18n.t('No stations configured. Click "Add Station" to get started.')})}):t.jsx(e.List,{children:l.map(i=>t.jsxs(e.ListItemButton,{selected:s===i.id,sx:{border:"1px solid",borderColor:"divider",borderRadius:1,mb:1,"&.Mui-selected":{backgroundColor:"action.selected"}},onClick:()=>h(i.id),children:[t.jsx(e.ListItemText,{primary:i.name,secondary:`ID: ${i.id}`,primaryTypographyProps:{fontWeight:500},secondaryTypographyProps:{variant:"caption"}}),t.jsx(e.IconButton,{edge:"end","aria-label":"delete",onClick:d=>{d.stopPropagation(),o(i.id)},size:"small",children:t.jsx(S.Delete,{})})]},i.id))})})]});class g extends c.ConfigGeneric{searchTimeout=null;constructor(s){super(s),this.state={...this.state,searchQuery:"",stations:[],selectedStation:null,loading:!1,error:null}}handleClose=()=>{this.props.onClose&&this.props.onClose(),this.setState({searchQuery:"",stations:[],selectedStation:null,error:null})};handleSearchChange=s=>{const a=s.target.value;this.setState({searchQuery:a}),this.searchTimeout&&clearTimeout(this.searchTimeout),a.length>=2?this.searchTimeout=setTimeout(()=>{this.searchStations(a)},500):this.setState({stations:[],selectedStation:null})};searchStations=async s=>{this.setState({loading:!0,error:null});try{const a=await this.props.oContext.socket.sendTo(`${this.props.oContext.adapterName}.${this.props.oContext.instance}`,"location",{query:s});a&&Array.isArray(a)?this.setState({stations:a,loading:!1}):this.setState({stations:[],loading:!1,error:n.I18n.t("stationSearch_no_results_found")})}catch(a){this.setState({loading:!1,error:n.I18n.t("stationSearch_error").replace("%s",a instanceof Error?a.message:String(a))})}};handleStationSelect=s=>{this.setState({selectedStation:s})};handleConfirm=()=>{this.state.selectedStation&&(console.log("Confirming station:",this.state.selectedStation),this.props.onStationSelected&&this.props.onStationSelected(this.state.selectedStation.id,this.state.selectedStation.name),this.handleClose())};renderItem(s,a){const{searchQuery:o,stations:h,selectedStation:i,loading:d,error:m}=this.state;return t.jsxs(e.Dialog,{open:!0,onClose:this.handleClose,maxWidth:"sm",fullWidth:!0,children:[t.jsx(e.DialogTitle,{children:n.I18n.t("stationSearch_title")}),t.jsxs(e.DialogContent,{children:[t.jsx(e.TextField,{autoFocus:!0,fullWidth:!0,label:n.I18n.t("stationSearch_input_label"),value:o,onChange:this.handleSearchChange,placeholder:n.I18n.t("stationSearch_input_placeholder"),sx:{mt:2,mb:2}}),d&&t.jsx(e.Box,{sx:{display:"flex",justifyContent:"center",p:2},children:t.jsx(e.CircularProgress,{})}),m&&t.jsx(e.Typography,{color:"error",sx:{p:2,textAlign:"center"},children:m}),!d&&!m&&h.length>0&&t.jsx(e.List,{sx:{maxHeight:400,overflow:"auto"},children:h.map(r=>{var f,u;return t.jsx(e.ListItem,{disablePadding:!0,children:t.jsx(e.ListItemButton,{selected:(i==null?void 0:i.id)===r.id,onClick:()=>this.handleStationSelect(r),children:t.jsx(e.ListItemText,{primary:r.name,secondary:r.type?`${r.type}${r.location?` (${(f=r.location.latitude)==null?void 0:f.toFixed(4)}, ${(u=r.location.longitude)==null?void 0:u.toFixed(4)})`:""}`:r.id})})},r.id)})}),!d&&!m&&o.length>=2&&h.length===0&&t.jsx(e.Typography,{color:"text.secondary",sx:{p:2,textAlign:"center"},children:n.I18n.t("stationSearch_no_results")}),o.length<2&&t.jsx(e.Typography,{color:"text.secondary",sx:{p:2,textAlign:"center"},children:n.I18n.t("stationSearch_min_chars")})]}),t.jsxs(e.DialogActions,{children:[t.jsx(e.Button,{onClick:this.handleClose,children:n.I18n.t("stationSearch_cancel")}),t.jsx(e.Button,{onClick:this.handleConfirm,variant:"contained",disabled:!i,children:n.I18n.t("stationSearch_confirm")})]})]})}}class B extends c.ConfigGeneric{constructor(s){super(s),this.state={...this.state,stations:[],selectedStationId:null,showSearchDialog:!1}}componentDidUpdate(s){s.data!==this.props.data&&this.props.data&&this.setState({stations:this.props.data})}handleAddStation=()=>{this.setState({showSearchDialog:!0})};handleStationSelected=(s,a)=>{const o={id:s,name:a};if(!this.state.stations.some(i=>i.id===s)){const i=[...this.state.stations,o];this.setState({stations:i}),this.props.onChange&&this.props.onChange(i)}this.setState({showSearchDialog:!1})};handleDeleteStation=s=>{const a=this.state.stations.filter(o=>o.id!==s);this.setState({stations:a}),this.props.onChange&&this.props.onChange(a),this.state.selectedStationId===s&&this.setState({selectedStationId:null})};handleStationClick=s=>{this.setState({selectedStationId:s})};handleCloseSearch=()=>{this.setState({showSearchDialog:!1})};render(){const{stations:s,selectedStationId:a,showSearchDialog:o}=this.state,h=s.find(i=>i.id===a)||null;return t.jsxs(e.Box,{sx:{height:"100%",p:{xs:1,sm:2}},children:[t.jsxs(e.Grid,{container:!0,spacing:{xs:1,sm:2},sx:{height:"100%",flexDirection:{xs:"column",md:"row"}},children:[t.jsx(e.Grid,{item:!0,xs:12,md:5,sx:{height:{xs:"auto",md:"100%"},minHeight:{xs:300,md:"auto"},maxHeight:{xs:400,md:"none"}},children:t.jsx(D,{stations:s,selectedStationId:a,onAddStation:this.handleAddStation,onDeleteStation:this.handleDeleteStation,onStationClick:this.handleStationClick})}),t.jsx(e.Grid,{item:!0,xs:12,md:7,sx:{height:{xs:"auto",md:"100%"},minHeight:{xs:200,md:"auto"}},children:t.jsx(A,{station:h})})]}),t.jsx(e.Dialog,{open:o,onClose:this.handleCloseSearch,maxWidth:"md",fullWidth:!0,fullScreen:!1,sx:{"& .MuiDialog-paper":{m:{xs:1,sm:2},maxHeight:{xs:"calc(100% - 16px)",sm:"calc(100% - 64px)"},width:{xs:"calc(100% - 16px)",sm:"auto"}}},children:t.jsx(g,{...this.props,onStationSelected:this.handleStationSelected,onClose:this.handleCloseSearch})})]})}}class k extends c.ConfigGeneric{constructor(s){super(s),this.state={...this.state,showStationSearch:!1}}renderItem(s,a){const o=c.ConfigGeneric.getValue(this.props.data,"hafasProfile"),h=c.ConfigGeneric.getValue(this.props.data,"clientName"),i=c.ConfigGeneric.getValue(this.props.data,"stationId"),d=c.ConfigGeneric.getValue(this.props.data,"stationName"),m=async x=>{const p=x.target.value;await this.onChange("hafasProfile",p)},r=async x=>{const p=x.target.value;await this.onChange("clientName",p)},f=()=>{this.setState({showStationSearch:!0})},u=()=>{this.setState({showStationSearch:!1})},_=async(x,p)=>{console.log("Station selected:",{id:x,name:p}),console.log("Saving stationId:",x),console.log("Saving stationName:",p),await this.onChange("stationId",x),await this.onChange("stationName",p);const C=c.ConfigGeneric.getValue(this.props.data,"stationId"),y=c.ConfigGeneric.getValue(this.props.data,"stationName");console.log("Saved values:",{savedId:C,savedName:y}),this.setState({showStationSearch:!1})};return t.jsxs(e.Box,{sx:{p:{xs:1,sm:2},maxWidth:1200,mx:"auto"},children:[t.jsx(e.Typography,{variant:"h5",sx:{mb:{xs:2,sm:3},fontSize:{xs:"1.25rem",sm:"1.5rem"}},children:n.I18n.t("hafasConfig_title")}),t.jsxs(e.Box,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,mb:3},children:[t.jsxs(e.FormControl,{sx:{flex:{sm:"1 1 0"},minWidth:{xs:"100%",sm:200}},disabled:a,fullWidth:!0,children:[t.jsx(e.InputLabel,{id:"hafas-profile-label",children:n.I18n.t("hafasConfig_profile_label")}),t.jsxs(e.Select,{labelId:"hafas-profile-label",id:"hafas-profile-select",value:o||"",label:n.I18n.t("hafasConfig_profile_label"),onChange:m,children:[t.jsx(e.MenuItem,{value:"vbb",children:n.I18n.t("hafasConfig_profile_vbb")}),t.jsx(e.MenuItem,{value:"db",children:n.I18n.t("hafasConfig_profile_db")})]}),t.jsx(e.FormHelperText,{children:n.I18n.t("hafasConfig_profile_helper")})]}),t.jsx(e.FormControl,{sx:{flex:{sm:"1 1 0"},minWidth:{xs:"100%",sm:200}},disabled:a,fullWidth:!0,children:t.jsx(e.TextField,{id:"client-name-input",label:n.I18n.t("hafasConfig_clientName_label"),value:h||"",onChange:r,helperText:n.I18n.t("hafasConfig_clientName_helper"),disabled:a,fullWidth:!0})})]}),t.jsxs(e.Box,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,alignItems:{sm:"flex-start"}},children:[t.jsx(e.TextField,{label:n.I18n.t("hafasConfig_station_label"),value:d||i||"",InputProps:{readOnly:!0},helperText:i?n.I18n.t("hafasConfig_station_helper_id").replace("%s",i):n.I18n.t("hafasConfig_station_helper_empty"),disabled:a,fullWidth:!0,sx:{flex:{sm:1}}}),t.jsx(e.Button,{variant:"contained",onClick:f,disabled:a,sx:{mt:{xs:0,sm:.5},minWidth:{xs:"100%",sm:120},height:{xs:48,sm:56}},fullWidth:!1,children:n.I18n.t("hafasConfig_station_search_button")})]}),this.state.showStationSearch&&t.jsx(g,{...this.props,onStationSelected:_,onClose:u})]})}}const E={DepartureManager:B,HafasConfig:k,StationSearch:g};export{E as default};
